# 八百屋アプリ

## 概要

* クリーンアーキテクチャ及びドメイン駆動設計で設計または実装することを思考した八百屋アプリ

## 目標

* 依存性の方向を意識して設計（クリーンアーキテクチャ）
* 集約単位でデータを永続化
* 集約または集約の内部は、集約ルートを経由してアクセス

## ユースケース

* お客さん
  * 代金を支払い野菜を購入する。
  * 購入した野菜のうち、いずれかの野菜を返品する
  * 購入した野菜をすべて返品する

## 集約、エンティティ、値オブジェクト

* 売り上げ
  * 売り上げ全体の情報と、個々の売り上げ明細を管理する集約
  * ルートエンティティは`売り上げ`
* 売り上げ
  * `売り上げ`集約の集約ルート（ルートエンティティ）
  * 販売日時、売り上げ明細（複数）、合計代金などをフィールドに持つ
* 売り上げ明細
  * 売り上げた野菜、単価、数量、小計などをフィールドに持つ値オブジェクト

## ドメインルール

* お客さんは、1回の購入（`売り上げ`）で、1つ以上の野菜を1以上の数量で購入できる。
  * `売り上げ`エンティティには、必ず1つ以上の`売り上げ明細`が存在する。
  * `売り上げ明細`の数量は、必ず1以上である。
  * `売り上げ明細`の小計を合計した結果を、`売り上げ`の`合計代金`に記録する。
* お客さんは、代金を支払うとその`売り上げ`が確定して、野菜を追加で購入できない。
  * 既存の`売り上げ`エンティティに`売り上げ明細`を追加できない。
  * この場合、お客さんは、新しい`売り上げ`として購入する。
* お客さんは、購入した野菜（`売り上げ明細`）のうち、1つの野菜を1以上から購入した数量まで返品できる。
  * それ以外の野菜の`売り上げ明細`について、小計を合計した結果を、`売り上げ`の`合計代金`に記録する。
  * このとき、当該野菜の数量が0になり、かつ、当該売上にそれ以外の野菜を売り上げていない（それ以外の野菜の`売り上げ明細`がない）場合、購入自体がキャンセルされる。
* お客さんは、購入した野菜をすべて返品することで、購入をキャンセルできる。
  * `打ち上げ`をキャンセルする。
* 八百屋に野菜の在庫が無限にあるとする（欠品なし、話を簡単にするために`在庫`の概念を持たない。）。
